<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Lending Loan Mentor</title>
  <meta name="csrf-token" content="{{ csrf_token }}">
  <style>
    /* ... (ìŠ¤íƒ€ì¼ ìƒëµ ì—†ì´ ì „ì²´ ìœ ì§€) ... */
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background-color: #f8eedf;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    header {
      background-color: #39462c;
      height: 80px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    header img {
      height: 60px;
    }

    .menu-wrapper {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
    }

    .menu-button {
      background-color: #39462c;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 20px;
      cursor: pointer;
    }

    .dropdown-menu {
      display: none;
      flex-direction: column;
      background-color: #39462c;
      border: 1px solid #555;
      border-radius: 10px;
      position: absolute;
      top: 40px;
      right: 0;
      min-width: 140px;
      z-index: 1001;
    }

    .dropdown-menu button {
      background: none;
      border: none;
      padding: 10px 20px;
      text-align: left;
      font-size: 14px;
      color: white;
      cursor: pointer;
    }

    .dropdown-menu button:hover {
      background-color: #2d3c25;
    }

    .dropdown-menu.open {
      display: flex;
    }

    .sidebar-toggle {
      position: fixed;
      top: 90px;
      left: 230px;
      width: 36px;
      height: 36px;
      background-color: #39462c;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 20px;
      cursor: pointer;
      z-index: 1000;
      transition: left 0.3s ease;
    }

    .main {
      display: flex;
      flex: 1;
      height: calc(100vh - 80px);
    }

    .sidebar {
      width: 220px;
      background-color: #435334;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      transition: width 0.3s ease;
      overflow: hidden;
    }

    .sidebar.collapsed {
      width: 0;
      padding: 0;
    }

    .sidebar img {
      width: 220px;
      height: auto;
      margin-bottom: 20px;
      transition: opacity 0.2s ease;
    }

    .sidebar.collapsed img {
      opacity: 0;
    }

    .sidebar-link {
      width: 180px;
      padding: 10px 15px;
      margin: 8px 0;
      background-color: #435334;
      color: #ffffff;
      font-size: 15px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
      text-align: center;
    }

    .sidebar-link:hover {
      background-color: #e4dbb8;
      color: #2c351f;
    }

    .chat-area {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      overflow: hidden;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 20px;
    }

    .chat-bubble {
      max-width: 70%;
      margin: 10px 0;
      padding: 15px 20px;
      border-radius: 20px;
      line-height: 1.6;
    }

    .user {
      align-self: flex-end;
      background-color: #fff;
      border: 1px solid #ccc;
      font-weight: bold;
    }

    .bot {
      align-self: flex-start;
      background-color: #fff5e8;
      border: 1px solid #ffe9cc;
      display: flex;
    }

    .bot::before {
      content: 'A';
      background-color: #e7f5d9;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      text-align: center;
      line-height: 28px;
      font-weight: bold;
      margin-right: 10px;
    }

    .input-area {
      display: flex;
      width: 80%;
      margin: 10px auto;
    }

    .input-area input {
      flex: 1;
      padding: 12px 16px;
      background-color: #ffeed6;
      border: 2px solid #ccc;
      border-radius: 30px 0 0 30px;
      font-size: 16px;
      outline: none;
    }

    .input-area button {
      background-color: #39462c;
      color: white;
      border: none;
      padding: 0 20px;
      border-radius: 0 8px 8px 0;
      font-size: 18px;
      cursor: pointer;
    }

    .hint-toggle {
      width: 90%;
      margin: 0 auto 10px;
      display: block;
      background-color: #39462c;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .chatbot-hint-box {
      background-color: #fff5e8;
      border: 1px solid #ffe9cc;
      padding: 16px 20px;
      margin: 10px auto 20px;
      border-radius: 10px;
      font-size: 14px;
      width: 90%;
      transition: max-height 0.4s ease, opacity 0.4s ease;
    }

    .chatbot-hint-box table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background-color: #fff;
    }

    .chatbot-hint-box th,
    .chatbot-hint-box td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    .chatbot-hint-box th {
      background-color: #f0e7cd;
    }

    .chatbot-hint-box.hidden {
      display: none;
    }
  </style>
</head>
<body>

  <!-- âœ… í—¤ë” -->
  <header>
    <img src="{% static 'main/images/logo.png' %}" alt="Lending Loan Mentor">
    <div class="menu-wrapper">
      <button class="menu-button" onclick="toggleMenu()">â‹®</button>
      <div class="dropdown-menu" id="dropdownMenu">
        <button onclick="location.reload()"> ëŒ€í™” ì´ˆê¸°í™”</button>
        <button onclick="downloadChat()"> ëŒ€í™” ë‹¤ìš´ë¡œë“œ</button>
        <button onclick="location.href='/'"> ëŒ€í™” ì¢…ë£Œ</button>
        
      </div>
    </div>
  </header>

  <!-- âœ… ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
  <button class="sidebar-toggle" id="toggleBtn" onclick="toggleSidebar()">â˜°</button>

  <!-- âœ… ì „ì²´ ë ˆì´ì•„ì›ƒ -->
  <div class="main">
    <!-- âœ… ì‚¬ì´ë“œë°” -->
    <div class="sidebar" id="sidebar">
      <img src="{% static 'main/images/logo3.png' %}" alt="Sidebar ë¡œê³ " />
      <button onclick="location.href='./main'" class="sidebar-link"> ì±—ë´‡ ìƒë‹´</button>
      <button onclick="location.href='./calculator'" class="sidebar-link"> ëŒ€ì¶œìƒí™˜ê³„ì‚°ê¸°</button>
    </div>

    <!-- âœ… ì±—ë´‡ í™”ë©´ -->
    <div class="chat-area">
      <div class="chat-messages" id="chat-area"></div>

      <!-- âœ… ì•ˆë‚´ í† ê¸€ ë²„íŠ¼ + ë°•ìŠ¤ -->
      <button class="hint-toggle" onclick="toggleHint()"> ì‹¬ì‚¬ í•­ëª© ì•ˆë‚´ ì ‘ê¸°/í¼ì¹˜ê¸°</button>
      <div id="hintBox" class="chatbot-hint-box">
        <strong>ğŸ’¡ ë” ì •í™•í•œ ìƒë‹´ì„ ìœ„í•´ ì•„ë˜ í•­ëª©ë“¤ì„ í•¨ê»˜ ì…ë ¥í•´ ì£¼ì„¸ìš”:</strong>
        <table>
          <thead>
            <tr>
              <th>ì‹¬ì‚¬ í•­ëª©</th>
              <th>ì£¼ìš” ë‚´ìš© ë° ì˜í–¥</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>ì†Œë“ ë° ì§ì—… ì•ˆì •ì„±</td><td>ì—°ì†Œë“, ì¬ì§ê¸°ê°„, ì§ì¥ ìœ í˜•</td></tr>
            <tr><td>ì‹ ìš©ë“±ê¸‰/ì ìˆ˜</td><td>ì‹ ìš©ì ìˆ˜, ì—°ì²´ ì´ë ¥, ê¸ˆìœµê±°ë˜</td></tr>
            <tr><td>ê¸°ì¡´ ë¶€ì±„/ëŒ€ì¶œ</td><td>ì”ì•¡, DSR, ìƒí™˜ ì´ë ¥</td></tr>
            <tr><td>ì€í–‰ ê±°ë˜ ì‹¤ì </td><td>ê¸‰ì—¬ì´ì²´, ì¹´ë“œ, ìë™ì´ì²´</td></tr>
            <tr><td>ê¸°íƒ€</td><td>ìì‚°, ê°€ì¡±ê´€ê³„, ì •ì±…ìƒí’ˆ ì—¬ë¶€</td></tr>
          </tbody>
        </table>
      </div>

      <!-- âœ… ì…ë ¥ì°½ -->
      <div class="input-area">
        <input type="text" id="user-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." />
        <button onclick="sendMessage()">â¤</button>
      </div>
    </div>
  </div>

  <!-- âœ… JS -->
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const toggleBtn = document.getElementById('toggleBtn');
      sidebar.classList.toggle('collapsed');
      toggleBtn.style.left = sidebar.classList.contains('collapsed') ? '10px' : '230px';
    }

    function toggleMenu() {
      const menu = document.getElementById("dropdownMenu");
      menu.classList.toggle("open");
    }

    function toggleHint() {
      const box = document.getElementById("hintBox");
      box.classList.toggle("hidden");
    }

    async function sendMessage() {
      const input = document.getElementById("user-input");
      const message = input.value.trim();
      if (!message) return;
      input.value = "";

      const userBubble = document.createElement("div");
      userBubble.className = "chat-bubble user";
      userBubble.textContent = message;
      document.getElementById("chat-area").appendChild(userBubble);

      const csrftoken = document.querySelector('meta[name="csrf-token"]').getAttribute("content");
      const response = await fetch("/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": csrftoken
        },
        body: JSON.stringify({ message })
      });

      const data = await response.json();

      const botBubble = document.createElement("div");
      botBubble.className = "chat-bubble bot";
      botBubble.textContent = data.reply;
      document.getElementById("chat-area").appendChild(botBubble);

      document.getElementById("chat-area").scrollTop = document.getElementById("chat-area").scrollHeight;
    }

    function downloadChat() {
      const chatArea = document.getElementById("chat-area");
      const chatBubbles = chatArea.querySelectorAll(".chat-bubble");
      let chatText = "";

      chatBubbles.forEach(bubble => {
        const isUser = bubble.classList.contains("user");
        const prefix = isUser ? "ì‚¬ìš©ì: " : "ì±—ë´‡: ";
        chatText += prefix + bubble.textContent + "\n";
      });

      const blob = new Blob([chatText], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "chat_log.txt";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>




